<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>휴대폰 인증</title>
  <link rel="stylesheet" th:href="@{/css/member/phoneAuth.css}" />
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAuHVRYWq72wUqxdYRsft6kvxXhg03V2jM",
      authDomain: "lotteon-bd31e.firebaseapp.com",
      projectId: "lotteon-bd31e",
      storageBucket: "lotteon-bd31e.firebasestorage.app",
      messagingSenderId: "121588575858",
      appId: "1:121588575858:web:d870507a370ea07e3d5ceb",
      measurementId: "G-VQN8SQWW41"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>
<div class="container">
  <header>
    <img th:src="@{/images/logo.png}" alt="LotteOn 로고" />
  </header>
  <section>
    <form th:action="@{/user/member/findIdResult}" method="post" onsubmit="return validateAuth()">
      <h2><strong>정보</strong>를 <br />입력해주세요</h2>

      <!-- 이름 -->
      <input type="text" id="name" name="name" placeholder="이름" required />

      <!-- 전화번호 -->
      <input type="text" id="phone" name="hp" placeholder="+821012345678 형식" required />

      <!-- recaptcha 영역 -->
      <div id="recaptcha-container"></div>
      <button type="button" onclick="sendCode()">인증번호 받기</button>

      <!-- 인증번호 입력 -->
      <input type="text" id="code" name="authCode" placeholder="인증번호 입력" required />
      <button type="button" onclick="verifyCode()">인증 확인</button>

      <button type="submit" id="nextBtn" disabled>다음</button>
    </form>
  </section>
</div>

<script>
  let confirmationResult = null;

  function sendCode() {
    const phoneNumber = document.getElementById("phone").value;
    const appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
      size: 'invisible'
    });

    firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
            .then((result) => {
              confirmationResult = result;
              alert("인증번호를 전송했습니다.");
            }).catch((error) => {
      alert("인증 실패: " + error.message);
    });
  }

  function verifyCode() {
    const code = document.getElementById("code").value;
    confirmationResult.confirm(code)
            .then((result) => {
              alert("인증 성공!");
              document.getElementById("nextBtn").disabled = false;
            }).catch((error) => {
      alert("인증 실패: " + error.message);
    });
  }

  function validateAuth() {
    return !document.getElementById("nextBtn").disabled;
  }
</script>
</body>
</html>