<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/layout/layout.css">
    <link rel="stylesheet" href="/css/product/list.css">
    <title>상품목록 : 롯데On</title>
</head>

<body>
<script>
    // 슬라이드 인덱스 저장
    let index = 0;

    // 슬라이더 이동 함수
    function moveSlide(direction) {
        const slides = document.getElementById('slides');
        const totalSlides = Math.ceil(slides.children.length / 2);

        index += direction;
        if (index < 0) index = totalSlides - 1;
        if (index >= totalSlides) index = 0;

        slides.style.transform = `translateX(-${index * 100}%)`;
    }

    // 리스트 / 그리드 뷰 전환 함수
    function toggleView(view) {
        const wrapper = document.getElementById('productWrapper');
        const toGridBtn = document.getElementById('toGrid');
        const toListBtn = document.getElementById('toList');

        wrapper.classList.remove('list', 'grid');
        wrapper.classList.add(view);

        // 버튼 상태도 같이 바꾸기
        if (view === 'grid') {
            toGridBtn.style.display = 'none';
            toListBtn.style.display = 'inline-block';
        } else {
            toGridBtn.style.display = 'inline-block';
            toListBtn.style.display = 'none';
        }
    }

    // DOM 로드 후 실행
    document.addEventListener("DOMContentLoaded", function () {
        // 카테고리 아코디언 기능
        const parents = document.querySelectorAll(".category .parent");

        parents.forEach(parent => {
            parent.style.cursor = "pointer";

            parent.addEventListener("click", () => {
                const currentChildren = parent.nextElementSibling;

                document.querySelectorAll(".category .children").forEach(children => {
                    if (children !== currentChildren) {
                        children.style.display = "none";
                    }
                });

                if (currentChildren && currentChildren.classList.contains("children")) {
                    const isVisible = currentChildren.style.display === "block";
                    currentChildren.style.display = isVisible ? "none" : "block";
                }
            });
        });

        document.getElementById('salesPeriodSelect').addEventListener('change', function () {
            const period = this.value;
            const subCateNo = '[[${pageResponseDTO.subCateNo}]]';

            if (period !== "") {
                location.href = `/product/list/mostSales${period}?sortType=mostSales&period=${period}&subCateNo=${subCateNo}`;
            }
        });

        document.getElementById('reviewPeriodSelect').addEventListener('change', function () {
            const period = this.value; // 1y, 6m, 1m
            const subCateNo = '[[${pageResponseDTO.subCateNo}]]';

            if (period !== "") {
                location.href = `/product/list/manyReviews${period}?sortType=manyReviews&period=${period}&subCateNo=${subCateNo}`;
            }
        });

        function attachProductClickHandler(containerSelector, cardSelector) {
            const container = document.querySelector(containerSelector);

            if (!container) return;

            container.addEventListener('click', function (e) {
                if (
                    e.target.closest('.icons') ||
                    e.target.closest('.star') ||
                    e.target.closest('.review')
                ) return;

                const card = e.target.closest(cardSelector);
                const prodNo = card?.dataset.prodno;

                if (prodNo) {
                    location.href = `/product/view?prodNo=${prodNo}`;
                }
            });
        }

        attachProductClickHandler('.best-grid', '.best-card');
        attachProductClickHandler('#productWrapper', '.product-item');

    });
</script>

<div id="wrapper">
    <!-- 헤더 시작 -->
    <th:block th:include="/common/header.html"/>
    <!-- 헤더 끝 -->
    <main>
        <section class="content">
            <div class="bar">
                <div>
                    <a href="#">HOME</a>&nbsp;&nbsp;>&nbsp;&nbsp;
                    <a href="#">뷰티</a>&nbsp;&nbsp;>&nbsp;&nbsp;
                    <a href="#">향수</a>
                </div>
            </div>
            <p class="page_name">향수</p>
            <!-- 사이드바-->
            <aside>
                <div class="category">
                    <p>카테고리</p>
                    <div class="category-item">
                        <div class="parent">뷰티</div>
                        <div class="children">
                            <a href="/view/product/beauty/skincare/skincare.html">스킨케어</a>
                            <a href="/view/product/beauty/makeup">메이크업</a>
                            <a href="/view/product/beauty/perfume">향수</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">럭셔리</div>
                        <div class="children">
                            <a href="/view/product/luxury/bag">가방</a>
                            <a href="/view/product/luxury/watch">시계</a>
                            <a href="/view/product/luxury/shoes">신발</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">여성패션</div>
                        <div class="children">
                            <a href="/view/product/wfashion/onepiece">원피스</a>
                            <a href="/view/product/wfashion/blouse">블라우스</a>
                            <a href="/view/product/wfashion/pants">팬츠</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">남성패션</div>
                        <div class="children">
                            <a href="/view/product/mfashion/shirt">셔츠</a>
                            <a href="/view/product/mfashion/slacks">슬랙스</a>
                            <a href="/view/product/mfashion/jacket">자켓</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">가전</div>
                        <div class="children">
                            <a href="/view/product/electronics/computer">컴퓨터</a>
                            <a href="/view/product/electronics/game">게임</a>
                            <a href="/view/product/electronics/tv">티비</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">가구</div>
                        <div class="children">
                            <a href="/view/product/furniture/sofa">쇼파</a>
                            <a href="/view/product/furniture/bed">침구</a>
                            <a href="/view/product/furniture/wardrobe">옷장</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">반려동물</div>
                        <div class="children">
                            <a href="/view/product/pet/dog">강아지</a>
                            <a href="/view/product/pet/cat">고양이</a>
                            <a href="/view/product/pet/parrot">앵무새</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">취미</div>
                        <div class="children">
                            <a href="/view/product/hobby/knitting">뜨개</a>
                            <a href="/view/product/hobby/badminton">배드민턴</a>
                            <a href="/view/product/hobby/poldance">폴댄스</a>
                        </div>
                    </div>

                    <div class="category-item">
                        <div class="parent">여행</div>
                        <div class="children">
                            <a href="/view/product/travel/asia">아시아</a>
                            <a href="/view/product/travel/europe">유럽</a>
                            <a href="/view/product/travel/northamerica">북미</a>
                        </div>
                    </div>
                </div>
            </aside>
            <!-- 사이드 바 끝 -->
            <div class="container">
                <div class="slider">
                    <div class="slides" id="slides">
                        <img src="/images/product/banner1.jpg" alt="배너 1">
                        <img src="/images/product/banner2.jpg" alt="배너 2">
                        <img src="/images/product/banner1.jpg" alt="배너 3">
                        <img src="/images/product/banner2.jpg" alt="배너 4">
                    </div>
                    <button class="prev" onclick="moveSlide(-1)">&#10094;</button>
                    <button class="next" onclick="moveSlide(1)">&#10095;</button>
                </div>

                <h2>카테고리 베스트 상품</h2>
                <div class="best-grid">
                    <div class="best-card"
                         th:each="product, stat : ${productDTOList}"
                         th:attr="data-prodno=${product.prodNo}">
                        <p class="rank" th:text="${stat.count}">1</p>
                        <img class="product-img" th:src="${product.sNameList}" alt="상품 이미지" />
                        <div class="vendor-row">
                            <span class="vendor-name" th:text="${product.company}">판매자명</span>
                            <div class="icons">
                                <button><img th:src="@{/images/product/icon_favorite.png}" alt="찜"></button>
                                <button><img th:src="@{/images/product/icon_cart.png}" alt="장바구니"></button>
                            </div>
                        </div>
                        <p class="name">
                            <span class="brand" th:text="${product.prodBrand}"></span>
                            <span class="product-name" th:text="${product.prodName}">상품명</span>
                        </p>
                        <p class="price">
                            <span class="discount" th:text="${product.prodDiscount + '%'}">10%</span>
                            <span th:text="${#numbers.formatInteger(product.prodPrice, 3, 'COMMA')} + '원'">155,800원</span>
                        </p>
                        <p class="review">
                            <span class="star" th:text="'★ ' + ${product.ratingTotal}">★ 4.8</span>
                            &nbsp;&nbsp;|&nbsp;&nbsp;리뷰 <span th:text="${product.reviewCount}">123</span>
                        </p>
                    </div>
                </div>

                <div class="nab_bar">
                    <div class="nav">
                        <div>
                            <select id="salesPeriodSelect">
                                <option value="">판매많은순</option>
                                <option value="1year">1년</option>
                                <option value="6month">6개월</option>
                                <option value="1month">1개월</option>
                            </select>
                            <a th:href="@{/product/list/lowPrice(sortType='lowPrice', subCateNo=${pageResponseDTO.subCateNo})}">&nbsp;&nbsp;|&nbsp;&nbsp;낮은가격순&nbsp;&nbsp;|&nbsp;&nbsp;</a>
                            <a th:href="@{/product/list/highPrice(sortType='highPrice', subCateNo=${pageResponseDTO.subCateNo})}">높은가격순&nbsp;&nbsp;|&nbsp;&nbsp;</a>
                            <a th:href="@{/product/list/highRating(sortType='highRating', subCateNo=${pageResponseDTO.subCateNo})}">평점높은순&nbsp;&nbsp;|&nbsp;&nbsp;</a>
                            <select id="reviewPeriodSelect">
                                <option value="">후기많은순</option>
                                <option value="1year">1년</option>
                                <option value="6month">6개월</option>
                                <option value="1month">1개월</option>
                            </select>
                            <a th:href="@{/product/list/latest(sortType='latest', subCateNo=${pageResponseDTO.subCateNo})}">&nbsp;&nbsp;|&nbsp;&nbsp;최근등록순
                            </a>
                        </div>
                    </div>

                    <div class="view-toggle">
                        <button id="toGrid" onclick="toggleView('grid')">
                            <img src="/images/product/grid.png" alt="그리드 보기">
                        </button>
                        <button id="toList" onclick="toggleView('list')" style="display: none;">
                            <img src="/images/product/list.png" alt="리스트 보기">
                        </button>
                    </div>
                </div>

                <div id="productWrapper" class="product-wrapper list">
                    <div class="product-list">
                        <div class="product-item" th:each="product : ${pageResponseDTO.dtoList}" th:attr="data-prodno=${product.prodNo}">
                            <img th:src="${product.sNameList}" alt="상품 썸네일">
                            <div class="product-info">
                                <span class="vendor-name" th:text="${product.company}">판매자명</span><br>
                                <span class="brand" th:text="${product.prodBrand}">브랜드</span>
                                <span class="pname" th:text="${product.prodName}">상품명</span>
                                <div class="meta">
                                    <span th:text="'★ ' + ${product.ratingAvg}">★ 4.8</span>&nbsp;|&nbsp;리뷰 <span th:text="${product.reviewCount}">0</span>
                                </div>
                                <span class="badge-free" th:if="${product.prodDeliveryFee == 0}">무료배송</span>
                                <span class="badge-fee" th:if="${product.prodDeliveryFee != 0}" th:text="${#numbers.formatInteger(product.prodDeliveryFee, 3, 'COMMA') + '원'}">배송비</span>
                            </div>
                            <div class="product-price">
                                <del th:text="${#numbers.formatInteger(product.prodPrice, 3, 'COMMA')} + '원'">정가</del><br>
                                <span class="discount" th:text="${product.prodDiscount + '%'}">할인율</span>
                                <span th:text="${#numbers.formatInteger(product.prodPrice * (100 - product.prodDiscount) / 100, 3, 'COMMA')}">판매가</span> 원
                                <div class="icons">
                                    <button><img src="/images/product/icon_favorite.png" alt="찜"></button>
                                    <button><img src="/images/product/icon_cart.png" alt="장바구니"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <th:block th:if="${pageResponseDTO.prev}">
                        <a th:href="@{/product/list/manyReviews1month(sortType='manyReviews', period='1month', pg=${pageResponseDTO.start - 1}, subCateNo=${pageResponseDTO.subCateNo})}" class="prev">&lt;</a>
                    </th:block>
                    <th:block th:each="num : ${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                        <a th:href="@{/product/list/manyReviews1month(sortType='manyReviews', period='1month', pg=${num}, subCateNo=${pageResponseDTO.subCateNo})}"
                           th:class="${num == pageResponseDTO.pg} ? 'current' : 'num'">
                            [[${num}]]
                        </a>
                    </th:block>
                    <th:block th:if="${pageResponseDTO.next}">
                        <a th:href="@{/product/list/manyReviews1month(sortType='manyReviews', period='1month', pg=${pageResponseDTO.end + 1}, subCateNo=${pageResponseDTO.subCateNo})}" class="next">&gt;</a>
                    </th:block>
                </div>

            </div>
        </section>
    </main>

    <!-- 푸터 시작 -->
    <th:block th:include="/common/footer.html"/>
    <!-- 푸터 끝 -->
</div>
</body>
</html>
